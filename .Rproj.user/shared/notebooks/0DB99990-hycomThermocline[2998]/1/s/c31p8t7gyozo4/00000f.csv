"0","calcThermoVars <- function(depth, temp, mldMode='SST8', thermMode='variso', plot=FALSE) {"
"0","    # depthInterp <- approxfun(x=temp, y=depth)"
"0","    switch(match.arg(mldMode),"
"0","           'SST8' = {"
"0","               mldTemp <- temp[1] - 0.8"
"0","               # first few temps are likely to have repeat values that trigger"
"0","               # warnings for approxfun, so cut off to only values after mldTemp"
"0","               useMin <- min(which(temp <= mldTemp)) - 1"
"0","               useIx <- useMin:length(temp)"
"0","               depthInterp <- approxfun(x=temp[useIx], y=depth[useIx])"
"0","               mld <- depthInterp(mldTemp)"
"0","           }"
"0","    )"
"0","    switch(match.arg(thermMode),"
"0","           'variso' = {"
"0","               t400 <- approx(x=depth, y=temp, xout=400)$y"
"0","               # therm end is half way to t400 temp"
"0","               tEnd <- mldTemp + (t400 - mldTemp)/2"
"0","               # therm temp is midpt from mld to end"
"0","               tt <- (mldTemp + tEnd)/2"
"0","               # tt <- mldTemp - .25 * (mldTemp - t400)"
"0","               ttDepth <- depthInterp(tt)"
"0","               tEndDepth <- depthInterp(tEnd)"
"0","           }"
"0","    )"
"0","    if(plot) {"
"0","        to300 <- depth <= 300"
"0","        plot(x=temp[to300], y=-depth[to300],"
"0","             main = paste0('MixLayer: ', round(mld,0), 'm ', round(mldTemp, 1), 'C',"
"0","                           '\nTherm: ', round(ttDepth, 0), 'm ', round(tt, 1), 'C'),"
"0","             xlab='Temp (C)', ylab='Depth (m)')"
"0","        "
"0","        lines(x=temp[to300], y=-depth[to300])"
"0","        lines(x=c(mldTemp, tEnd), y=c(-mld, -tEndDepth), col='darkgray', lwd=4)"
"0","        points(x=c(mldTemp, tt), y=c(-mld, -ttDepth), col='blue', cex=1.5, pch=15)"
"0","    }"
"0","    list(mldDepth = mld, mldTemp = mldTemp,"
"0","         ttDepth = ttDepth, ttTemp = tt)"
"0","}"
